<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Where is my $ - doodozz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        body { padding-bottom: 100px; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Microsoft JhengHei", sans-serif; }
        .card-shadow { box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .main-title { letter-spacing: -0.02em; font-size: 1.75rem; line-height: 1.2; }
        .doodozz-sig { letter-spacing: 0.35em; font-size: 10px; color: #94a3b8; font-weight: 800; text-indent: 0.35em; }
        .nav-text { font-size: 13px !important; letter-spacing: 1px !important; margin-top: 4px; }
        [v-cloak] { display: none; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen">
    <div id="app" v-cloak class="max-w-md mx-auto min-h-screen bg-white shadow-2xl relative">
        
        <header class="p-8 border-b bg-white sticky top-0 z-20 text-center">
            <h1 class="main-title font-black text-slate-800 uppercase">Where is my $</h1>
            <p class="doodozz-sig mt-2 uppercase text-blue-400/70">Designed by doodozz</p>
        </header>

        <main class="p-4">
            <div v-if="currentTab === 'asset'">
                <section class="mb-6 text-center">
                    <p class="text-xs text-gray-400 mb-2 font-black uppercase tracking-[0.2em]">ç¸½è³‡ç”¢æ·¨å€¼</p>
                    <div class="bg-slate-900 p-8 rounded-[2rem] text-white shadow-xl">
                        <p class="text-4xl font-black">${{ Math.round(grandTotal).toLocaleString() }}</p>
                    </div>
                </section>

                <div class="space-y-3">
                    <div class="p-4 bg-white border border-slate-100 rounded-2xl flex justify-between items-center card-shadow">
                        <span class="font-bold text-slate-500">ğŸ‡¹ğŸ‡¼ å°è‚¡ç¸½å¸‚å€¼</span>
                        <span class="font-black text-slate-800">${{ Math.round(totalTWValue).toLocaleString() }}</span>
                    </div>

                    <div class="p-4 bg-white border border-slate-100 rounded-2xl flex justify-between items-center card-shadow">
                        <div class="flex flex-col">
                            <span class="font-bold text-slate-500">ğŸ‡ºğŸ‡¸ ç¾è‚¡ç¸½å¸‚å€¼</span>
                            <span class="text-[10px] text-gray-400 font-medium">åŒ¯ç‡: {{ exchangeRate }}</span>
                        </div>
                        <span class="font-black text-slate-800">${{ Math.round(totalUSValueInTWD).toLocaleString() }}</span>
                    </div>

                    <div class="p-4 bg-emerald-50 border border-emerald-100 rounded-2xl card-shadow">
                        <div class="flex justify-between items-center mb-2">
                            <span class="font-bold text-emerald-800 text-sm">ğŸ›¡ï¸ é å‚™é‡‘</span>
                            <button @click="manualReserve = totalReserve" class="text-[10px] bg-emerald-200 text-emerald-700 px-3 py-1 rounded-lg font-black">åŒæ­¥è¨ˆç®—</button>
                        </div>
                        <div class="flex items-center">
                            <span class="text-emerald-700 mr-2 font-black">$</span>
                            <input v-model.number="manualReserve" type="number" class="w-full bg-transparent border-b border-emerald-200 focus:border-emerald-500 outline-none font-black text-emerald-900 text-xl">
                        </div>
                    </div>

                    <div class="p-4 bg-slate-50 rounded-2xl border border-dashed border-slate-200">
                        <h3 class="text-[10px] font-black text-slate-400 mb-3 uppercase tracking-widest">å…¶ä»–è³‡ç”¢</h3>
                        <div class="space-y-2 mb-4">
                            <div v-for="m in manualAssets" :key="m.id" class="flex justify-between items-center bg-white p-3 rounded-xl shadow-sm">
                                <span class="text-slate-500 font-bold text-sm">{{ m.name }}</span>
                                <div class="flex items-center gap-3">
                                    <span class="font-black text-slate-800 text-sm">${{ Math.round(m.amount).toLocaleString() }}</span>
                                    <button @click="openManualEdit(m)" class="text-slate-300">âœ</button>
                                    <button @click="deleteManualAsset(m.id)" class="text-red-200">âœ•</button>
                                </div>
                            </div>
                        </div>
                        <button @click="openManualAdd" class="w-full bg-slate-800 text-white py-2 rounded-xl font-bold text-sm">æ–°å¢é …ç›®</button>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'position'">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex gap-1 bg-gray-100 p-1 rounded-xl">
                        <button v-for="m in ['å°è‚¡', 'ç¾è‚¡']" @click="market = m" :class="['px-5 py-1.5 rounded-lg text-sm font-bold transition', market === m ? 'bg-white shadow-sm text-blue-600' : 'text-gray-400']">{{ m }}</button>
                    </div>
                    <div v-if="market === 'ç¾è‚¡'" class="flex items-center gap-2">
                        <button @click="usdMode = !usdMode" class="bg-slate-800 text-white px-3 py-1.5 rounded-lg text-xs font-black shadow-md">
                            {{ usdMode ? 'USD' : 'TWD' }}
                        </button>
                    </div>
                </div>

                <div class="bg-blue-600 rounded-3xl p-6 mb-6 text-white shadow-lg relative overflow-hidden">
                    <div class="relative z-10">
                        <p class="text-xs font-black opacity-80 uppercase tracking-widest mb-1">{{ market }}ç•¶å‰å¸‚å€¼</p>
                        <h2 class="text-3xl font-black mb-4">{{ formatPrecisePrice(market === 'å°è‚¡' ? totalTWValue : (totalUSValueInTWD / exchangeRate)) }}</h2>
                        <div class="flex justify-between items-end">
                            <div>
                                <p class="text-[14px] font-black opacity-80 uppercase tracking-widest mb-1">å¹³å‡æç›Š</p>
                                <p class="text-xl font-black" :class="marketStats.profit >= 0 ? 'text-red-300' : 'text-green-300'">
                                    {{ marketStats.profit >= 0 ? '+' : '' }}{{ marketStats.profit.toFixed(2) }}%
                                </p>
                            </div>
                            <div>
                                <p class="text-[14px] font-black opacity-80 uppercase tracking-widest mb-1 text-right">ä½”ç¸½æŒè‚¡</p>
                                <p class="text-xl font-black text-right">{{ marketStats.ratio.toFixed(1) }}%</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <div v-for="stock in filteredStocks" :key="stock.id" class="border border-slate-100 rounded-3xl p-5 bg-white card-shadow relative">
                        <div class="absolute top-5 right-5 flex gap-3">
                            <a :href="'https://www.google.com/search?q=' + (market==='å°è‚¡'?'TPE:':'') + stock.symbol + '+stock'" target="_blank" class="text-blue-300 text-lg">ğŸ”</a>
                            <button @click="openEditModal(stock)" class="text-slate-300 text-lg">âœ</button>
                            <button @click="removeStock(stock)" class="text-slate-200 text-lg">âœ•</button>
                        </div>
                        <div class="mb-4">
                            <span class="text-[10px] font-bold text-blue-400 uppercase tracking-tighter">{{ stock.isSIP ? 'ğŸš€ å®šæœŸå®šé¡' : 'ğŸ“¦ å€‹è‚¡æŒå€‰' }}</span>
                            <h3 class="font-black text-xl text-slate-800">{{ stock.name }} <span class="text-xs text-slate-300 font-normal">({{ stock.symbol }})</span></h3>
                        </div>
                        <div class="grid grid-cols-3 gap-2">
                            <div class="bg-slate-50 p-3 rounded-2xl text-center">
                                <p class="text-[10px] text-gray-400 font-bold mb-1">å¸‚å€¼ ({{ currentCurrencyLabel }})</p>
                                <p class="font-black text-slate-700 text-sm">{{ formatPrecisePrice(stock.currentPrice * stock.shares) }}</p>
                            </div>
                            <div class="bg-slate-50 p-3 rounded-2xl text-center">
                                <p class="text-[10px] text-gray-400 font-bold mb-1">ä½”æ¯”</p>
                                <p class="font-black text-blue-600 text-sm">{{ getRatio(stock).toFixed(1) }}%</p>
                            </div>
                            <div class="bg-slate-50 p-3 rounded-2xl text-center">
                                <p class="text-[10px] text-gray-400 font-bold mb-1">æç›Š</p>
                                <p :class="stock.currentPrice >= stock.cost ? 'text-red-500' : 'text-green-600'" class="font-black text-sm">
                                    {{ (((stock.currentPrice/stock.cost)-1)*100).toFixed(2) }}%
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <button @click="openAddModal" class="w-full mt-6 py-4 border-2 border-dashed border-slate-200 rounded-2xl text-slate-400 font-bold text-xs uppercase tracking-widest">ï¼‹ æ–°å¢æŒè‚¡ç´€éŒ„</button>

                <div v-if="showModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-6 backdrop-blur-sm">
                    <div class="bg-white w-full max-h-[90vh] overflow-y-auto rounded-[2.5rem] p-6 shadow-2xl">
                        <h2 class="text-xl font-black mb-6">{{ isEditing ? 'ä¿®æ”¹' : 'æ–°å¢' }}æŒè‚¡</h2>
                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <input v-model="modalItem.name" placeholder="è‚¡ç¥¨åç¨±" class="p-4 bg-slate-100 rounded-2xl outline-none font-bold text-sm">
                                <input v-model="modalItem.symbol" placeholder="ä»£è™Ÿ(å¦‚:2330)" class="p-4 bg-slate-100 rounded-2xl outline-none font-bold text-sm">
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <input v-model.number="modalItem.cost" type="number" step="0.01" placeholder="æˆæœ¬" class="p-4 bg-slate-100 rounded-2xl outline-none font-bold">
                                <input v-model.number="modalItem.shares" type="number" placeholder="è‚¡æ•¸" class="p-4 bg-slate-100 rounded-2xl outline-none font-bold">
                            </div>
                            <input v-model.number="modalItem.currentPrice" type="number" step="0.01" placeholder="æœ€æ–°ç¾åƒ¹ (åƒè€ƒGoogleè¡Œæƒ…)" class="w-full p-4 bg-blue-50 rounded-2xl outline-none font-bold border-2 border-blue-200">
                            
                            <div class="p-4 bg-slate-50 rounded-3xl border border-slate-100">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-2">
                                        <span class="text-xl">ğŸš€</span>
                                        <span class="text-sm font-black text-slate-600">è¨­å®šå®šæœŸå®šé¡</span>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" v-model="modalItem.isSIP" class="sr-only peer">
                                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                                
                                <div v-if="modalItem.isSIP" class="grid grid-cols-2 gap-3 mt-4 pt-4 border-t border-slate-200/50">
                                    <div>
                                        <p class="text-[10px] font-bold text-gray-400 mb-1">æ¯æœˆæ‰£æ¬¾æ—¥</p>
                                        <input v-model.number="modalItem.sipDay" type="number" min="1" max="31" class="w-full p-3 bg-white rounded-xl outline-none text-sm font-bold border border-slate-200">
                                    </div>
                                    <div>
                                        <p class="text-[10px] font-bold text-gray-400 mb-1">æ‰£æ¬¾é‡‘é¡</p>
                                        <input v-model.number="modalItem.sipAmount" type="number" class="w-full p-3 bg-white rounded-xl outline-none text-sm font-bold border border-slate-200">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="flex gap-4 mt-8">
                            <button @click="showModal = false" class="flex-1 py-4 font-bold text-slate-400 text-xs">å–æ¶ˆ</button>
                            <button @click="handleModalSubmit" class="flex-1 py-4 bg-blue-600 text-white rounded-2xl font-black">å„²å­˜è¨­å®š</button>
                        </div>
                    </div>
                </div>

                <div v-if="sipPending.length > 0" class="fixed inset-0 bg-slate-900/80 flex items-center justify-center z-[60] p-6 backdrop-blur-md">
                    <div class="bg-white w-full rounded-[2.5rem] p-8 text-center shadow-2xl">
                        <p class="text-4xl mb-4">ğŸ’°</p>
                        <h2 class="text-xl font-black mb-2">å®šæœŸå®šé¡ç´€éŒ„æé†’</h2>
                        <p class="text-sm text-gray-500 mb-6 leading-relaxed">åµæ¸¬åˆ°æ‰£æ¬¾æ—¥å·²éï¼Œè¦å¹«æ‚¨ç´€éŒ„æœ¬æ¬¡æŠ•è³‡å—ï¼Ÿ<br><span class="text-blue-500 font-bold">ç³»çµ±å°‡ä»¥ç›®å‰ç¾åƒ¹ä¼°ç®—è‚¡æ•¸</span></p>
                        <div class="space-y-3 max-h-48 overflow-y-auto mb-6">
                            <div v-for="item in sipPending" class="bg-slate-50 p-3 rounded-xl flex justify-between items-center">
                                <div class="text-left">
                                    <p class="font-black text-sm text-slate-700">{{ item.name }}</p>
                                    <p class="text-[10px] text-gray-400">{{ item.date }} æ‰£æ¬¾</p>
                                </div>
                                <p class="font-black text-blue-600">${{ item.amount.toLocaleString() }}</p>
                            </div>
                        </div>
                        <div class="flex flex-col gap-2">
                            <button @click="confirmAllSIP" class="w-full py-4 bg-blue-600 text-white rounded-2xl font-black shadow-lg shadow-blue-200">ç¢ºèªä¸¦è‡ªå‹•æ”¤å¹³</button>
                            <button @click="sipPending = []" class="w-full py-4 text-slate-300 font-bold text-xs">å¿½ç•¥æœ¬æ¬¡æé†’</button>
                        </div>
                    </div>
                </div>
            </div>

            </main>

        <nav class="fixed bottom-0 max-w-md w-full bg-white/95 backdrop-blur-md border-t border-slate-100 flex justify-around py-4 z-30">
            <button v-for="t in ['asset','position','profit','reserve']" @click="currentTab = t" :class="['flex flex-col items-center transition-all duration-300', currentTab === t ? 'scale-110 text-blue-600' : 'text-slate-300']">
                <span class="text-2xl mb-1">{{ {asset:'ğŸ’°', position:'ğŸ“ˆ', profit:'ğŸ¯', reserve:'ğŸ›¡ï¸'}[t] }}</span>
                <span class="nav-text font-black uppercase tracking-tighter">{{ {asset:'è³‡ç”¢ç¸½è¦½', position:'æŒè‚¡ç´°ç¯€', profit:'åœåˆ©è©¦ç®—', reserve:'é å‚™é‡‘'}[t] }}</span>
            </button>
        </nav>
    </div>

    <script>
        const { createApp, ref, computed, watch, onMounted } = Vue;
        createApp({
            setup() {
                const currentTab = ref('asset');
                const market = ref('å°è‚¡');
                const stocks = ref([]);
                const usdMode = ref(false);
                const exchangeRate = ref(32.5);
                const showModal = ref(false);
                const isEditing = ref(false);
                const editingId = ref(null);
                const sipPending = ref([]);
                const modalItem = ref({ name: '', symbol: '', type: 'å€‹è‚¡', cost: null, shares: null, currentPrice: null, isSIP: false, sipDay: 10, sipAmount: 5000 });
                const manualAssets = ref([]);
                const manualReserve = ref(0);

                onMounted(() => {
                    const saved = localStorage.getItem('wealth-master-permanent');
                    if (saved) {
                        const data = JSON.parse(saved);
                        stocks.value = data.stocks || [];
                        manualAssets.value = data.manualAssets || [];
                        exchangeRate.value = data.exchangeRate || 32.5;
                        manualReserve.value = data.manualReserve || 0;
                        checkSIP(data.lastCheckDate);
                    }
                });

                watch([stocks, manualAssets, exchangeRate, manualReserve], () => {
                    localStorage.setItem('wealth-master-permanent', JSON.stringify({
                        stocks: stocks.value, manualAssets: manualAssets.value, 
                        exchangeRate: exchangeRate.value, manualReserve: manualReserve.value,
                        lastCheckDate: new Date().toISOString()
                    }));
                }, { deep: true });

                const checkSIP = (lastCheck) => {
                    if (!lastCheck) return;
                    const now = new Date();
                    const last = new Date(lastCheck);
                    const pending = [];
                    stocks.value.forEach(s => {
                        if (s.isSIP && s.sipDay && s.sipAmount) {
                            let checkCursor = new Date(last);
                            checkCursor.setDate(last.getDate() + 1);
                            while (checkCursor <= now) {
                                if (checkCursor.getDate() === s.sipDay) {
                                    pending.push({ id: s.id, name: s.name, amount: s.sipAmount, date: checkCursor.toLocaleDateString() });
                                }
                                checkCursor.setDate(checkCursor.getDate() + 1);
                            }
                        }
                    });
                    sipPending.value = pending;
                };

                const confirmAllSIP = () => {
                    sipPending.value.forEach(p => {
                        const s = stocks.value.find(x => x.id === p.id);
                        if (s && s.currentPrice > 0) {
                            const newShares = p.amount / s.currentPrice;
                            const totalCost = (s.cost * s.shares) + p.amount;
                            s.shares += newShares;
                            s.cost = totalCost / s.shares;
                        }
                    });
                    sipPending.value = [];
                    alert('ç´€éŒ„å®Œæˆï¼');
                };

                const handleModalSubmit = () => {
                    if (!modalItem.value.name || !modalItem.value.cost) return;
                    if (isEditing.value) {
                        const idx = stocks.value.findIndex(s => s.id === editingId.value);
                        stocks.value[idx] = { ...modalItem.value };
                    } else {
                        stocks.value.push({ ...modalItem.value, id: Date.now(), market: market.value });
                    }
                    showModal.value = false;
                };

                const openAddModal = () => { isEditing.value = false; modalItem.value = { name: '', symbol: '', type: 'å€‹è‚¡', cost: null, shares: null, currentPrice: null, isSIP: false, sipDay: 10, sipAmount: 5000 }; showModal.value = true; };
                const openEditModal = (s) => { isEditing.value = true; editingId.value = s.id; modalItem.value = { ...s }; showModal.value = true; };
                const removeStock = (s) => { if(confirm(`ç¢ºå®šåˆªé™¤ ${s.name}ï¼Ÿ`)) stocks.value = stocks.value.filter(x => x.id !== s.id); };
                const deleteManualAsset = (id) => { if(confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')) manualAssets.value = manualAssets.value.filter(x => x.id !== id); };
                const openManualAdd = () => { /* é‚è¼¯åŒå‰ */ };
                const openManualEdit = (m) => { /* é‚è¼¯åŒå‰ */ };

                const formatPrecisePrice = (val) => val.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
                const filteredStocks = computed(() => stocks.value.filter(s => s.market === market.value));
                const totalTWValue = computed(() => stocks.value.filter(s => s.market === 'å°è‚¡').reduce((sum, s) => sum + (s.currentPrice * s.shares), 0));
                const totalUSValueInTWD = computed(() => stocks.value.filter(s => s.market === 'ç¾è‚¡').reduce((sum, s) => sum + (s.currentPrice * s.shares), 0) * exchangeRate.value);
                const totalMarketValueAll = computed(() => totalTWValue.value + totalUSValueInTWD.value);
                const grandTotal = computed(() => (totalMarketValueAll.value + (manualReserve.value || 0) + manualAssets.value.reduce((s, x) => s + (x.amount || 0), 0)));
                const currentCurrencyLabel = computed(() => (market.value === 'ç¾è‚¡' && usdMode.value) ? 'USD' : 'TWD');
                const getRatio = (s) => totalMarketValueAll.value === 0 ? 0 : (((s.currentPrice * s.shares * (s.market==='ç¾è‚¡'?exchangeRate.value:1)) / totalMarketValueAll.value) * 100);
                
                const marketStats = computed(() => {
                    const list = filteredStocks.value;
                    if (list.length === 0) return { profit: 0, ratio: 0 };
                    const mTotal = list.reduce((s, x) => s + (x.currentPrice * x.shares), 0);
                    const mCost = list.reduce((s, x) => s + (x.cost * x.shares), 0);
                    const ratio = totalMarketValueAll.value === 0 ? 0 : (mTotal * (market.value==='ç¾è‚¡'?exchangeRate.value:1) / totalMarketValueAll.value) * 100;
                    return { profit: ((mTotal / mCost) - 1) * 100, ratio };
                });

                return { 
                    currentTab, market, stocks, showModal, isEditing, modalItem, openAddModal, openEditModal, handleModalSubmit, removeStock, usdMode, exchangeRate,
                    filteredStocks, totalTWValue, totalUSValueInTWD, totalMarketValueAll, grandTotal, marketStats,
                    getRatio, formatPrecisePrice, currentCurrencyLabel, manualAssets, manualReserve, sipPending, confirmAllSIP, deleteManualAsset, openManualAdd, openManualEdit
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
